# PromptSE UI架构优化设计

## 当前状态分析
- ✅ 基础前端渲染已修复
- ❌ UI过于简陋，缺少高级功能
- ❌ 缺少README中描述的关键功能

## 优化目标架构

### 1. 整体布局设计

```
┌─────────────────────────────────────────────────────────┐
│ PromptSE - Prompt String Editor                         │
├─────────────────────────────────────────────────────────┤
│ [⚙️Settings] [📁Import] [Mode: M] [🔍Search Lexicon]     │
├─────────────────────────────────────────────────────────┤
│ ┌─ Entry 1 ──────────────────────────── [±] [✕] [≡]    │
│ │ ☑ Title: Character           Weight: (1.2)           │
│ │ Content: beautiful girl, long hair...                │
│ └─────────────────────────────────────────────────────┤
│ ┌─ Entry 2 ──────────────────────────── [±] [✕] [≡]    │
│ │ ☐ Title: Style               Weight: (1.0)           │
│ │ Content: anime style, detailed...                    │
│ └─────────────────────────────────────────────────────┤
│ [+ Add Entry] [Global Output Preview]                  │
├─────────────────────────────────────────────────────────┤
│ Output: (beautiful girl, long hair:1.2), anime style   │
└─────────────────────────────────────────────────────────┘
```

### 2. 模块化组件设计

#### A. 主容器 (MainContainer)
- 响应式布局，自适应节点大小
- 现代化暗色主题适配ComfyUI
- 流畅的动画和过渡效果
- 最小高度300px，可根据内容扩展

#### B. 头部工具栏 (HeaderToolbar)
- **设置按钮** (⚙️) - 打开全局设置面板
- **导入按钮** (📁) - 词库导入功能
- **模式切换** (Mode: M/S) - 单个/多个模式切换
- **搜索框** (🔍) - 实时搜索词库功能

#### C. 条目列表 (EntryList)
- 可拖拽排序的条目卡片
- 每个条目包含：
  - 启用/禁用复选框
  - 标题和内容预览
  - 权重调整控件 (± 按钮)
  - 删除按钮 (✕)
  - 拖拽手柄 (≡)
  - 展开/折叠状态

#### D. 条目编辑器 (EntryEditor) - 模态弹窗
- **标题编辑区** - 单行输入框
- **内容编辑区** - 多行文本区域
- **权重调整器** - ± 按钮和数值显示
- **词库搜索面板** - 实时搜索和插入
- **保存/取消按钮**

#### E. 词库面板 (LexiconPanel)
- **搜索框** - 支持中英文搜索
- **标签云** - 按类别显示词条
- **点击插入** - 直接添加到当前编辑内容
- **创建新词条** - 快速添加自定义词条

#### F. 设置面板 (SettingsPanel)
- **连接符配置** - 自定义多条目连接方式
- **输出格式选项** - 权重格式、括号样式
- **主题设置** - 颜色和样式选项
- **导入/导出** - 配置和词库管理

### 3. 技术架构优化

#### 前端架构 (JavaScript)
```javascript
class PromptSEUI {
  constructor(node) {
    this.node = node;
    this.data = node.promptse_data;
    this.components = {};
    this.eventHandlers = {};
    this.init();
  }
  
  // 组件系统
  createHeaderToolbar() { /* 创建工具栏 */ }
  createEntryList() { /* 创建条目列表 */ }
  createEntryEditor() { /* 创建编辑器 */ }
  createLexiconPanel() { /* 创建词库面板 */ }
  createSettingsPanel() { /* 创建设置面板 */ }
  
  // 功能系统
  handleDragDrop() { /* 拖拽排序 */ }
  handleWeightAdjustment() { /* 权重调整 */ }
  handleLexiconSearch() { /* 词库搜索 */ }
  updateOutput() { /* 更新输出预览 */ }
  
  // 数据管理
  syncData() { /* 同步数据到后端 */ }
  loadLexicon() { /* 加载词库文件 */ }
  exportConfig() { /* 导出配置 */ }
}
```

#### 数据结构优化
```javascript
{
  entries: [
    {
      id: "uuid-string",
      title: "条目标题",
      content: "提示词内容",
      enabled: true,
      weight: 1.0,
      order: 0
    }
  ],
  settings: {
    connector: ", ",
    mode: "M", // M=Multiple, S=Single
    outputFormat: "weighted", // weighted, simple
    weightFormat: "parentheses", // parentheses, brackets
    theme: "dark"
  },
  lexicon: [
    {
      english: "beautiful",
      chinese: "美丽的",
      category: "appearance",
      tags: ["beauty", "face"],
      weight: 1.0
    }
  ]
}
```

### 4. 用户体验设计

#### 视觉设计原则
- **现代化扁平设计** - 简洁清晰的界面
- **深色主题** - 适配ComfyUI的暗色调
- **清晰的视觉层次** - 信息组织有序
- **一致的间距和字体** - 统一的设计语言

#### 交互设计原则
- **直观的拖拽操作** - 简单的重排序功能
- **即时的视觉反馈** - 操作后立即显示结果
- **键盘快捷键支持** - 提高效率
- **响应式布局** - 适应不同尺寸

#### 功能优先级
1. **核心功能** - 条目管理、权重调整
2. **高级功能** - 词库系统、拖拽排序  
3. **增强功能** - 设置面板、主题定制

### 5. 实现路线图

#### 阶段1: 基础UI增强 (优先级: 高)
- [ ] 现代化样式重设计
- [ ] 条目卡片优化
- [ ] 权重调整控件
- [ ] 输出预览功能

#### 阶段2: 核心功能实现 (优先级: 高)
- [ ] 完整的编辑器模态框
- [ ] 拖拽排序系统
- [ ] 数据持久化优化

#### 阶段3: 高级功能 (优先级: 中)
- [ ] 词库导入和搜索
- [ ] 设置面板
- [ ] 主题定制

#### 阶段4: 用户体验优化 (优先级: 中)
- [ ] 动画和过渡效果
- [ ] 键盘快捷键
- [ ] 错误处理和用户反馈

### 6. 技术选型和约束

#### 技术约束
- 必须使用原生JavaScript (无外部框架)
- 遵循ComfyUI的扩展开发规范
- 确保与ComfyUI工作流系统兼容

#### 性能考虑
- 虚拟滚动 (大量条目时)
- 防抖处理 (搜索和输入)
- 内存管理 (避免内存泄漏)

### 7. 关键特性对比

| 功能 | 当前状态 | 优化后 |
|------|----------|--------|
| 基础UI | ✅ 简陋 | 🎨 现代化设计 |
| 条目管理 | ✅ 基础 | 🚀 增强功能 |
| 权重调整 | ❌ 无 | ✅ 直观控件 |
| 词库系统 | ❌ 无 | ✅ 完整实现 |
| 拖拽排序 | ❌ 无 | ✅ 流畅体验 |
| 设置面板 | ❌ 无 | ✅ 丰富选项 |
| 输出预览 | ❌ 无 | ✅ 实时预览 |
| 主题定制 | ❌ 无 | ✅ 多主题支持 |

## 下一步行动

这个架构设计将显著提升PromptSE节点的可用性和功能性，使其成为一个真正专业的提示词管理工具。

实现将按优先级分阶段进行，确保每个阶段都能带来可见的改进。